{% extends 'EnmashPagesBundle:Base:public_base.html.twig' %}

    {% block modals %}
        {% include('EnmashPagesBundle:Pages:Blocks/modals/findstoremap.html.twig') %}
    {% endblock %}

    {% block jumbotron %}
        {#top jumbotron slider#}
        {% include('EnmashPagesBundle:Pages:Blocks/index/jumboslider.html.twig') %}
    {% endblock %}

    {% block content %}

        {% include('EnmashPagesBundle:Pages:Blocks/index/about.html.twig') %}

        {% include('EnmashPagesBundle:Pages:Blocks/index/retail_chain.html.twig') %}

        {% include('EnmashPagesBundle:Pages:Blocks/index/wholesale.html.twig') %}

        {% include('EnmashPagesBundle:Pages:Blocks/index/banners.html.twig') %}

    {% endblock %}

    {% block js %}
    {{ parent() }}
    {#<script src="https://maps.googleapis.com/maps/api/js"></script>#}
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript" src="{{ asset('bundles/enmashpages/js/titlebanners.js') }}"></script>
    <script type="text/javascript">

        $(document).ready(function(){

            var map = null;

            $('#banners-carousel').titleBanners();

            $('#find-store-map').on('shown.bs.modal', function(e){
                if (map == null) {
                    $.ajax({
                        method: 'POST',
                        url: $('#find-store-map').attr('data-map-points-path'),
                        success: function(data) {
                            initialize(data);
                        }
                    });
                }
            })
        });

        //find store map
        function initialize(stores) {
            var mapCanvas = document.getElementById('map-canvas');

            //map options
            var mapOptions = {
                    center: new google.maps.LatLng(56.093126, 40.360195),
                zoom: 8,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            }

            //init the map
            var map = new google.maps.Map(mapCanvas, mapOptions);
            var markers = [];

            for (var i = 0; i < stores.length; i++) {
                var store = stores[i];
                var point = new google.maps.Marker({
                    position: new google.maps.LatLng(store.latitude, store.longitude),
                    map: map,
                    animation: google.maps.Animation.DROP,
                    title: store.address,
                    pointId: i
                });

                var infoWindow = new google.maps.InfoWindow({
                    content: '<div style="line-height:1.35;overflow:hidden;white-space:nowrap;"><h4>'+store.address+'</h4><p>'+store.contact+'</p></div>'
                });

                markers[i] = {
                    point: point,
                    info: infoWindow
                }

                point = markers[i].point;
                infoWindow = markers[i].infoWindow;

                google.maps.event.addListener(point, 'click', function(){
                    markers[this.pointId].info.open(map, this);
                });
            }

            console.log(markers);

            google.maps.event.addListener(map, 'bounds_changed', function() {
                google.maps.event.trigger(map, 'resize');
            });

            return map;

        }



    </script>
    {% endblock %}